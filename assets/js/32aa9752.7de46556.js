"use strict";(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[62107],{58721:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>r,contentTitle:()=>a,default:()=>m,frontMatter:()=>o,metadata:()=>d,toc:()=>t});var l=s(74848),i=s(28453);const o={id:"clone-os-image",title:"Clone OS image",sidebar_label:"Clone OS image",description:"Clone OS image from disk",keywords:["Linux","clone","backup"]},a=void 0,d={id:"linux/kernel/storage/clone-os-image",title:"Clone OS image",description:"Clone OS image from disk",source:"@site/docs/linux/kernel/storage/clone-os-image.mdx",sourceDirName:"linux/kernel/storage",slug:"/linux/kernel/storage/clone-os-image",permalink:"/docs/linux/kernel/storage/clone-os-image",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedAt:1725967579e3,frontMatter:{id:"clone-os-image",title:"Clone OS image",sidebar_label:"Clone OS image",description:"Clone OS image from disk",keywords:["Linux","clone","backup"]},sidebar:"linux-kernel",previous:{title:"fstab",permalink:"/docs/linux/kernel/storage/fstab"}},r={},t=[{value:"Read disk and save .img.xz",id:"read-disk-and-save-imgxz",level:2},{value:"Flash .img.xz to disk",id:"flash-imgxz-to-disk",level:2}];function c(e){const n={code:"code",h2:"h2",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h2,{id:"read-disk-and-save-imgxz",children:"Read disk and save .img.xz"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",metastring:"{1,8,15}",children:"$ sudo fdisk -l\n\n...\n\nDisk /dev/sdb: 14.86 GiB, 15931539456 bytes, 31116288 sectors\nDisk model: STORAGE DEVICE\nUnits: sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisklabel type: dos\nDisk identifier: 0xf7bdbfa9\n\nDevice     Boot  Start      End  Sectors  Size Id Type\n/dev/sdb1         8192   532479   524288  256M  c W95 FAT32 (LBA)\n/dev/sdb2       532480 31115263 30582784 14.6G 83 Linux\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"sudo umount /dev/sdb1 /dev/sdb2\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"sudo dd if=/dev/sdb of=clone.img bs=4M count=$((31115263 + 1)) status=progress\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",metastring:"{1}",children:"$ sudo parted -ms clone.img unit B print\nBYT;\n/home/hhk7734/clone.img:15931539456B:file:512:512:msdos::;\n1:4194304B:272629759B:268435456B:fat32::lba;\n2:272629760B:15931015167B:15658385408B:ext4::;\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",metastring:"{1}",children:"$ sudo losetup -f --show -o 272629760 clone.img\n/dev/loop20\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"sudo e2fsck -pf /dev/loop20\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",metastring:"{1}",children:"$ sudo tune2fs -l /dev/loop20 | grep -e '^Block size:' -e '^Block count:'\nBlock count:              3822848\nBlock size:               4096\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",metastring:"{1}",children:"$ sudo resize2fs -P /dev/loop20\nresize2fs 1.45.5 (07-Jan-2020)\nEstimated minimum size of the filesystem: 851980\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"sudo resize2fs -p /dev/loop20 $((851980 + 5000))\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"sudo losetup -d /dev/loop20\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"sudo parted -s -a minimal clone.img rm 2\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:'sudo parted -s clone.img unit B mkpart "primary" "272629760" \\\n    "$((272629760 + ((851980 + 5000) * 4096)))"\n'})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",metastring:"{1-2}",children:"$ sudo parted -ms clone.img unit B print free | tail -1 \\\n    | cut -d ':' -f 2 | tr -d 'B'\n3782820352\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"sudo truncate -s 3782820352 clone.img\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"sudo xz -vk -T$(($(nproc) - 2)) clone.img\n"})}),"\n",(0,l.jsx)(n.h2,{id:"flash-imgxz-to-disk",children:"Flash .img.xz to disk"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"xzcat -dvk -T$(($(nproc) - 2)) clone.img.xz \\\n| sudo dd of=/dev/sdb bs=4M status=progress conv=fsync\n"})}),"\n",(0,l.jsx)(n.p,{children:"or Use Etcher."})]})}function m(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>d});var l=s(96540);const i={},o=l.createContext(i);function a(e){const n=l.useContext(o);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),l.createElement(o.Provider,{value:n},e.children)}}}]);