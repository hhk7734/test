"use strict";(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[27291],{64878:(e,t,l)=>{l.r(t),l.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>m,frontMatter:()=>o,metadata:()=>s,toc:()=>i});var n=l(74848),a=l(28453);const o={id:"aws-load-balancer",title:"AWS Load Balancer Controller \uc124\uce58\ud558\uae30",sidebar_label:"Controller \uc124\uce58",description:"AWS Load Balancer Controller \uc124\uce58\ud558\uae30",keywords:["AWS Load Balancer Controller","Elastic Load Balancer"]},r=void 0,s={id:"mlops/mlops/network/aws-load-balancer/aws-load-balancer",title:"AWS Load Balancer Controller \uc124\uce58\ud558\uae30",description:"AWS Load Balancer Controller \uc124\uce58\ud558\uae30",source:"@site/docs/mlops/mlops/network/aws-load-balancer/aws-load-balancer.mdx",sourceDirName:"mlops/mlops/network/aws-load-balancer",slug:"/mlops/mlops/network/aws-load-balancer/",permalink:"/docs/mlops/mlops/network/aws-load-balancer/",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedAt:1724774597e3,frontMatter:{id:"aws-load-balancer",title:"AWS Load Balancer Controller \uc124\uce58\ud558\uae30",sidebar_label:"Controller \uc124\uce58",description:"AWS Load Balancer Controller \uc124\uce58\ud558\uae30",keywords:["AWS Load Balancer Controller","Elastic Load Balancer"]},sidebar:"mlops",previous:{title:"ARP/NDP",permalink:"/docs/mlops/mlops/network/metallb/arp"},next:{title:"Load Balancer \uc0dd\uc131\ud558\uae30",permalink:"/docs/mlops/mlops/network/aws-load-balancer/create"}},c={},i=[{value:"\uc0ac\uc804 \uc694\uad6c \uc0ac\ud56d",id:"\uc0ac\uc804-\uc694\uad6c-\uc0ac\ud56d",level:2},{value:"AWS Load Balancer Controller Role",id:"aws-load-balancer-controller-role",level:3},{value:"\uc124\uce58",id:"\uc124\uce58",level:2},{value:"\uc5c5\uadf8\ub808\uc774\ub4dc",id:"\uc5c5\uadf8\ub808\uc774\ub4dc",level:2}];function d(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h2,{id:"\uc0ac\uc804-\uc694\uad6c-\uc0ac\ud56d",children:"\uc0ac\uc804 \uc694\uad6c \uc0ac\ud56d"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://kubernetes-sigs.github.io/aws-load-balancer-controller/v2.6/deploy/installation/#configure-iam",children:"https://kubernetes-sigs.github.io/aws-load-balancer-controller/v2.6/deploy/installation/#configure-iam"})}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"aws-load-balancer-controller-role",children:"AWS Load Balancer Controller Role"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-ts",children:'const controllerRoleName = "aws-load-balancer-controller-role";\nconst controllerRole = new aws.iam.Role(\n\tcontrollerRoleName,\n\t{\n\t\tnamePrefix: `${controllerRoleName}-`,\n\t\tassumeRolePolicy: {\n\t\t\tVersion: "2012-10-17",\n\t\t\tStatement: [\n\t\t\t\t{\n\t\t\t\t\tEffect: "Allow",\n\t\t\t\t\tPrincipal: {\n\t\t\t\t\t\tFederated: variable.eks.core.eks.apply((eks) => eks.oidcProvider.arn),\n\t\t\t\t\t},\n\t\t\t\t\tCondition: {\n\t\t\t\t\t\tStringEquals: variable.eks.core.eks.apply((eks) => ({\n\t\t\t\t\t\t\t[`${eks.oidcProvider.url}:aud`]: "sts.amazonaws.com",\n\t\t\t\t\t\t\t[`${eks.oidcProvider.url}:sub`]:\n\t\t\t\t\t\t\t\t// system:serviceaccount:<namespace>:<serviceAccount>\n\t\t\t\t\t\t\t\t"system:serviceaccount:kube-system:aws-load-balancer-controller",\n\t\t\t\t\t\t})),\n\t\t\t\t\t},\n\t\t\t\t\tAction: "sts:AssumeRoleWithWebIdentity",\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\ttags: {\n\t\t\tName: controllerRoleName,\n\t\t\t"loliot.net/stack": variable.stackName,\n\t\t},\n\t},\n\t{ protect: true },\n);\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",children:"curl -o iam-policy.json https://raw.githubusercontent.com/kubernetes-sigs/aws-load-balancer-controller/v2.6.1/docs/install/iam_policy.json\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-ts",children:'const controllerPolicyName = "aws-load-balancer-controller-policy";\nconst controllerPolicy = new aws.iam.Policy(\n\tcontrollerPolicyName,\n\t{\n\t\tnamePrefix: `${controllerPolicyName}-`,\n\t\tpolicy: {\n\t\t\tVersion: "2012-10-17",\n\t\t\tStatement: [\n\t\t\t\t// ...\n\t\t\t],\n\t\t},\n\t\ttags: {\n\t\t\tName: controllerPolicyName,\n\t\t\t"loliot.net/stack": variable.stackName,\n\t\t},\n\t},\n\t{ protect: true },\n);\n\nnew aws.iam.RolePolicyAttachment(\n\t"aws-load-balancer-controller-rpa-0",\n\t{\n\t\tpolicyArn: controllerPolicy.arn,\n\t\trole: controllerRole.name,\n\t},\n\t{ protect: true },\n);\n'})}),"\n",(0,n.jsx)(t.h2,{id:"\uc124\uce58",children:"\uc124\uce58"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://kubernetes-sigs.github.io/aws-load-balancer-controller/v2.6/deploy/installation/#add-controller-to-cluster",children:"https://kubernetes-sigs.github.io/aws-load-balancer-controller/v2.6/deploy/installation/#add-controller-to-cluster"})}),"\n"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",children:"helm repo add eks https://aws.github.io/eks-charts\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",children:"helm repo update eks \\\n&& helm search repo eks/aws-load-balancer-controller -l | head -n 10\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",children:"helm show values eks/aws-load-balancer-controller \\\n    --version 1.6.2 \\\n    > aws-load-balancer-controller-values.yaml\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'title="aws-load-balancer-controller-values.yaml"',children:"serviceAccount:\n  name: aws-load-balancer-controller\n  annotations:\n    eks.amazonaws.com/role-arn: arn:aws:iam::<accountId>:role/<controllerRoleName>\n\nadditionalLabels: {}\n\nclusterName: <cluserName>\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",children:"helm template keda eks/aws-load-balancer-controller \\\n    --version 1.6.2 \\\n    -n kube-system \\\n    -f aws-load-balancer-controller-values.yaml \\\n    > aws-load-balancer-controller.yaml\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",children:"helm upgrade aws-load-balancer-controller eks/aws-load-balancer-controller \\\n    --install \\\n    --history-max 5 \\\n    --version 1.6.2 \\\n    -n kube-system \\\n    -f aws-load-balancer-controller-values.yaml\n"})}),"\n",(0,n.jsx)(t.h2,{id:"\uc5c5\uadf8\ub808\uc774\ub4dc",children:"\uc5c5\uadf8\ub808\uc774\ub4dc"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",children:"kubectl apply -f https://raw.githubusercontent.com/aws/eks-charts/master/stable/aws-load-balancer-controller/crds/crds.yaml\n"})})]})}function m(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},28453:(e,t,l)=>{l.d(t,{R:()=>r,x:()=>s});var n=l(96540);const a={},o=n.createContext(a);function r(e){const t=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),n.createElement(o.Provider,{value:t},e.children)}}}]);