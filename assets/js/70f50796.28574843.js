"use strict";(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[17695],{92977:(e,l,n)=>{n.r(l),n.d(l,{assets:()=>c,contentTitle:()=>r,default:()=>p,frontMatter:()=>s,metadata:()=>a,toc:()=>o});var i=n(74848),t=n(28453);const s={id:"pipeline",title:"Promtail Pipeline(\ub85c\uadf8 \ubcc0\ud658)",sidebar_label:"Pipeline(\ub85c\uadf8 \ubcc0\ud658)",description:"Promtail Pipeline(\ub85c\uadf8 \ubcc0\ud658)",keywords:["promtail","pipeline"]},r=void 0,a={id:"mlops/mlops/monitoring/collector/promtail/pipeline",title:"Promtail Pipeline(\ub85c\uadf8 \ubcc0\ud658)",description:"Promtail Pipeline(\ub85c\uadf8 \ubcc0\ud658)",source:"@site/docs/mlops/mlops/monitoring/collector/promtail/pipeline-stage.mdx",sourceDirName:"mlops/mlops/monitoring/collector/promtail",slug:"/mlops/mlops/monitoring/collector/promtail/pipeline",permalink:"/docs/mlops/mlops/monitoring/collector/promtail/pipeline",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedAt:1730127326e3,frontMatter:{id:"pipeline",title:"Promtail Pipeline(\ub85c\uadf8 \ubcc0\ud658)",sidebar_label:"Pipeline(\ub85c\uadf8 \ubcc0\ud658)",description:"Promtail Pipeline(\ub85c\uadf8 \ubcc0\ud658)",keywords:["promtail","pipeline"]},sidebar:"mlops",previous:{title:"Fluentd",permalink:"/docs/mlops/mlops/monitoring/collector/fluentd"},next:{title:"Vector",permalink:"/docs/mlops/mlops/monitoring/collector/vector/"}},c={},o=[{value:"Pipeline",id:"pipeline",level:2},{value:"Parsing stage",id:"parsing-stage",level:2},{value:"cri",id:"cri",level:3},{value:"multiline",id:"multiline",level:3},{value:"Transform stage",id:"transform-stage",level:2},{value:"template",id:"template",level:3},{value:"Action stage",id:"action-stage",level:2},{value:"Filtering stage",id:"filtering-stage",level:2},{value:"match",id:"match",level:3}];function d(e){const l={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l.h2,{id:"pipeline",children:"Pipeline"}),"\n",(0,i.jsxs)(l.ul,{children:["\n",(0,i.jsx)(l.li,{children:(0,i.jsx)(l.a,{href:"https://grafana.com/docs/loki/latest/send-data/promtail/pipelines/",children:"Pipeline"})}),"\n"]}),"\n",(0,i.jsx)(l.p,{children:"promtail \uc2dc\uc791 \uc2dc discovery(or static) -> relabel -> pipeline \uc21c\uc73c\ub85c \uc9c4\ud589\ub418\uba70, pipeline\uc774 \ubb34\ud55c \ubc18\ubcf5\ub418\uba74\uc11c \ub85c\uadf8\ub97c \uc218\uc9d1\ud558\uac8c \ub429\ub2c8\ub2e4."}),"\n",(0,i.jsxs)(l.p,{children:["pipeline\uc5d0\ub294 stage\ub77c\ub294 \ub2e8\uacc4\uac00 \uc788\uace0, \uc120\uc5b8\ub41c \uc21c\uc11c\ub85c \uc2e4\ud589\ub429\ub2c8\ub2e4. stage\uc5d0\uc11c\ub294 ",(0,i.jsx)(l.a,{href:"#parsing-stage",children:"Parsing"}),", ",(0,i.jsx)(l.a,{href:"#transform-stage",children:"Transform"}),", ",(0,i.jsx)(l.a,{href:"#action-stage",children:"Action"}),", ",(0,i.jsx)(l.a,{href:"#filtering-stage",children:"Filtering"})," \uc791\uc5c5\uc744 \uc218\ud589\ud569\ub2c8\ub2e4."]}),"\n",(0,i.jsx)(l.p,{children:"pipeline\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \ub370\uc774\ud130\ub294 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4."}),"\n",(0,i.jsxs)(l.ul,{children:["\n",(0,i.jsxs)(l.li,{children:["Labels","\n",(0,i.jsxs)(l.ul,{children:["\n",(0,i.jsx)(l.li,{children:"discovery(or static) + relabel \ub2e8\uacc4\uc5d0\uc11c \uc0dd\uc131\ub41c labels"}),"\n",(0,i.jsx)(l.li,{children:"\uc55e\uc120 stage\uc5d0\uc11c \uc0dd\uc131\ub41c labels"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(l.li,{children:["Extracted Map","\n",(0,i.jsxs)(l.ul,{children:["\n",(0,i.jsx)(l.li,{children:"discovery(or static) + relabel \ub2e8\uacc4\uc5d0\uc11c \uc0dd\uc131\ub41c labels"}),"\n",(0,i.jsx)(l.li,{children:"\uc55e\uc120 stage\uc5d0\uc11c \uc0dd\uc131\ub41c key-value map"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(l.li,{children:"timestamp"}),"\n",(0,i.jsx)(l.li,{children:"log line"}),"\n"]}),"\n",(0,i.jsx)(l.pre,{children:(0,i.jsx)(l.code,{className:"language-yaml",children:"pipeline_stages:\n  - <stage>:\n      <option>: <value>\n"})}),"\n",(0,i.jsx)(l.h2,{id:"parsing-stage",children:"Parsing stage"}),"\n",(0,i.jsx)(l.h3,{id:"cri",children:"cri"}),"\n",(0,i.jsxs)(l.ul,{children:["\n",(0,i.jsx)(l.li,{children:(0,i.jsx)(l.a,{href:"https://grafana.com/docs/loki/latest/send-data/promtail/stages/cri/",children:"Pipeline cri"})}),"\n"]}),"\n",(0,i.jsx)(l.pre,{children:(0,i.jsx)(l.code,{className:"language-yaml",children:"cri: {}\n"})}),"\n",(0,i.jsx)(l.p,{children:"cri\ub294 \uc544\ub798\uc640 \uac19\uc740 \uc791\uc5c5\uc744 \uc218\ud589\ud569\ub2c8\ub2e4."}),"\n",(0,i.jsx)(l.pre,{children:(0,i.jsx)(l.code,{className:"language-yaml",children:'- regex:\n    expression: "^(?s)(?P<time>\\\\S+?) (?P<stream>stdout|stderr) (?P<flags>\\\\S+?) (?P<content>.*)$"\n- labels:\n    stream:\n- timestamp:\n    source: time\n    format: RFC3339Nano\n- output:\n    source: content\n'})}),"\n",(0,i.jsx)(l.h3,{id:"multiline",children:"multiline"}),"\n",(0,i.jsxs)(l.ul,{children:["\n",(0,i.jsx)(l.li,{children:(0,i.jsx)(l.a,{href:"https://grafana.com/docs/loki/latest/send-data/promtail/stages/multiline/",children:"Pipeline multiline"})}),"\n"]}),"\n",(0,i.jsx)(l.pre,{children:(0,i.jsx)(l.code,{className:"language-yaml",children:"multiline:\n  # https://github.com/google/re2/wiki/Syntax\n  firstline: <re2>\n  # https://pkg.go.dev/time#ParseDuration\n  max_wait_time: 3s\n  max_lines: 128\n"})}),"\n",(0,i.jsx)(l.h2,{id:"transform-stage",children:"Transform stage"}),"\n",(0,i.jsx)(l.h3,{id:"template",children:"template"}),"\n",(0,i.jsxs)(l.ul,{children:["\n",(0,i.jsx)(l.li,{children:(0,i.jsx)(l.a,{href:"https://grafana.com/docs/loki/latest/send-data/promtail/stages/template/",children:"Pipeline template"})}),"\n",(0,i.jsx)(l.li,{children:(0,i.jsx)(l.a,{href:"https://github.com/grafana/loki/blob/7683a791912ba128ce8af88b294ae3722330dfa2/clients/pkg/logentry/stages/template.go#L110-L150",children:"stages/template.go"})}),"\n"]}),"\n",(0,i.jsx)(l.pre,{children:(0,i.jsx)(l.code,{className:"language-yaml",children:"template:\n  source: <key>\n  # https://pkg.go.dev/text/template\n  # https://masterminds.github.io/sprig/\n  template: <template>\n"})}),"\n",(0,i.jsxs)(l.ul,{children:["\n",(0,i.jsxs)(l.li,{children:[(0,i.jsx)(l.code,{children:"<key>"}),"\n",(0,i.jsxs)(l.ul,{children:["\n",(0,i.jsx)(l.li,{children:"Extracted Map\uc5d0 \uc788\uc73c\uba74 \ud574\ub2f9 key\uc758 value\ub97c \ud15c\ud50c\ub808\uc774\ud305 \ub41c \uac12\uc73c\ub85c \ub300\uccb4\ud569\ub2c8\ub2e4."}),"\n",(0,i.jsx)(l.li,{children:"Extracted Map\uc5d0 \uc5c6\uc73c\uba74 \ud574\ub2f9 key\ub97c \uc0dd\uc131\ud558\uace0 \ud15c\ud50c\ub808\uc774\ud305 \ub41c \uac12\uc73c\ub85c \ub300\uccb4\ud569\ub2c8\ub2e4."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(l.li,{children:[(0,i.jsx)(l.code,{children:"<template>"}),"\n",(0,i.jsxs)(l.ul,{children:["\n",(0,i.jsxs)(l.li,{children:["\ubcc0\uc218","\n",(0,i.jsxs)(l.ul,{children:["\n",(0,i.jsxs)(l.li,{children:[(0,i.jsx)(l.code,{children:"{{ .Value }}"}),": Extracted Map\uc5d0\uc11c source ",(0,i.jsx)(l.code,{children:"<key>"}),"\uc5d0 \ud574\ub2f9\ud558\ub294 \uac12\uc744 \uac00\uc838\uc635\ub2c8\ub2e4."]}),"\n",(0,i.jsxs)(l.li,{children:[(0,i.jsx)(l.code,{children:"{{ .Entry }}"}),": \ub85c\uadf8 \ub77c\uc778 \uc804\uccb4\ub97c \uac00\uc838\uc635\ub2c8\ub2e4."]}),"\n",(0,i.jsxs)(l.li,{children:[(0,i.jsx)(l.code,{children:"{{ .<key> }}"}),": Extracted Map\uc5d0\uc11c ",(0,i.jsx)(l.code,{children:"<key>"}),"\uc5d0 \ud574\ub2f9\ud558\ub294 \uac12\uc744 \uac00\uc838\uc635\ub2c8\ub2e4."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(l.h2,{id:"action-stage",children:"Action stage"}),"\n",(0,i.jsx)(l.h2,{id:"filtering-stage",children:"Filtering stage"}),"\n",(0,i.jsx)(l.h3,{id:"match",children:"match"}),"\n",(0,i.jsxs)(l.ul,{children:["\n",(0,i.jsx)(l.li,{children:(0,i.jsx)(l.a,{href:"https://grafana.com/docs/loki/latest/send-data/promtail/stages/match/",children:"Pipeline match"})}),"\n"]}),"\n",(0,i.jsx)(l.pre,{children:(0,i.jsx)(l.code,{className:"language-yaml",children:"match:\n  # https://grafana.com/docs/loki/latest/query/log_queries/#log-stream-selector\n  # https://grafana.com/docs/loki/latest/query/log_queries/#line-filter-expression\n  selector: <logql>\n  action: keep\n  stages: []\n"})})]})}function p(e={}){const{wrapper:l}={...(0,t.R)(),...e.components};return l?(0,i.jsx)(l,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453:(e,l,n)=>{n.d(l,{R:()=>r,x:()=>a});var i=n(96540);const t={},s=i.createContext(t);function r(e){const l=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(l):{...l,...e}}),[l,e])}function a(e){let l;return l=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),i.createElement(s.Provider,{value:l},e.children)}}}]);