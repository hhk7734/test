"use strict";(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[29800],{94343:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>x,frontMatter:()=>s,metadata:()=>t,toc:()=>a});var c=i(74848),l=i(28453),r=i(98180);const s={id:"device-tree-basics",title:"Device tree basics",sidebar_label:"Basics",description:"Device tree basics",keywords:["kernel","device tree"]},d=void 0,t={id:"linux/linux-kernel/device-tree/device-tree-basics",title:"Device tree basics",description:"Device tree basics",source:"@site/docs/linux/linux-kernel/device-tree/device-tree-basics.mdx",sourceDirName:"linux/linux-kernel/device-tree",slug:"/linux/linux-kernel/device-tree/device-tree-basics",permalink:"/docs/linux/linux-kernel/device-tree/device-tree-basics",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedAt:1723917838e3,frontMatter:{id:"device-tree-basics",title:"Device tree basics",sidebar_label:"Basics",description:"Device tree basics",keywords:["kernel","device tree"]},sidebar:"linux-kernel",previous:{title:"DKMS",permalink:"/docs/linux/linux-kernel/module/dkms"},next:{title:"Overlay",permalink:"/docs/linux/linux-kernel/device-tree/device-tree-overlay"}},o={},a=[{value:"Using device tree compiler",id:"using-device-tree-compiler",level:2},{value:"Check nodes and properties",id:"check-nodes-and-properties",level:3},{value:"DTS modification",id:"dts-modification",level:3},{value:"fdtget/fdtput",id:"fdtgetfdtput",level:4},{value:"Decompiled file modification",id:"decompiled-file-modification",level:4},{value:"Using Linux kernel source",id:"using-linux-kernel-source",level:2}];function h(e){const n={admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(n.p,{children:["Typically, ",(0,c.jsx)(n.strong,{children:"<.dtsi>"})," file contain definitions of SoC-level information."]}),"\n",(0,c.jsxs)(n.p,{children:["The ",(0,c.jsx)(n.strong,{children:"<.dts>"})," file contains board-level information."]}),"\n",(0,c.jsx)("center",{children:(0,c.jsx)("img",{src:(0,r.Ay)("img/linux/linux-kernel/device-tree/device-tree-inclusion-example.jpg")})}),"\n",(0,c.jsx)("center",{children:(0,c.jsx)("img",{src:(0,r.Ay)("img/linux/linux-kernel/device-tree/device-tree-terms.jpg")})}),"\n",(0,c.jsx)(n.h2,{id:"using-device-tree-compiler",children:"Using device tree compiler"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"sudo apt install -y device-tree-compiler\n"})}),"\n",(0,c.jsx)(n.h3,{id:"check-nodes-and-properties",children:"Check nodes and properties"}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"/proc/device-tree/"})," and ",(0,c.jsx)(n.code,{children:"/"})," node of a device tree source(DTS) are the same."]}),"\n",(0,c.jsx)(n.p,{children:"If a DTS is"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-clike",children:'/ {\n    model = "A";\n}\n'})}),"\n",(0,c.jsxs)(n.p,{children:["The structure of ",(0,c.jsx)(n.code,{children:"/proc/device-tree/"})," is as follows."]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"/proc/device-tree\n\u2514\u2500\u2500 model\n"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",metastring:"{1}",children:"$ cat /proc/device-tree\nA\n"})}),"\n",(0,c.jsx)(n.p,{children:"So, you can check DTS with one of the following commands."}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"tree /proc/device-tree\n"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"fdtdump <.dtb file name> | vim -\n"})}),"\n",(0,c.jsx)(n.h3,{id:"dts-modification",children:"DTS modification"}),"\n",(0,c.jsx)(n.h4,{id:"fdtgetfdtput",children:"fdtget/fdtput"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"fdtget <.dtb> <node> <property>\n"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"fdtput -t <type> <.dtb> <node> <property> <value>\n"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["type","\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"s=string, i=int, u=unsigned, x=hex"}),"\n",(0,c.jsx)(n.li,{children:"Optional modifier prefix: hh or b=byte, h=2 byte, l=4 byte (default)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.h4,{id:"decompiled-file-modification",children:"Decompiled file modification"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"dtc -I dtb -O dts <.dtb> -o <.dts>\n"})}),"\n",(0,c.jsxs)(n.p,{children:["After decompiling with the above command, edit ",(0,c.jsx)(n.code,{children:"<.dts>"}),". Then, compile the edited file with the below command."]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"dtc -I dts -O dtb <.dts> -o <.dtb>\n"})}),"\n",(0,c.jsx)(n.h2,{id:"using-linux-kernel-source",children:"Using Linux kernel source"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"git clone --depth=1 --branch=<branch> <repository>\n"})}),"\n",(0,c.jsx)(n.p,{children:"After editing DTS, check Makefile."}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-makefile",metastring:'title="linux/arch/<arch>/boot/dts/<vendor>/Makefile"',children:"dtb-$(CONFIG_ARCH_<BOARD>) += <board>.dtb\n"})}),"\n",(0,c.jsx)(n.p,{children:"Then, execute the below commands."}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"make xxx_defconfig \\\n&& make dtbs\n"})}),"\n",(0,c.jsxs)(n.p,{children:["Then, DTB will be created in ",(0,c.jsx)(n.code,{children:"linux/arch/<arch>/boot/"}),"."]}),"\n",(0,c.jsx)(n.admonition,{type:"tip",children:(0,c.jsxs)(n.p,{children:["If the above command fails, check ",(0,c.jsx)(n.strong,{children:"arch/<arch>/configs"}),". If not in arch/<arch>/configs, get a config file using ",(0,c.jsx)(n.code,{children:"zcat /proc/config.gz > <board>_defconfig"})," from the kernel installed on the desired board."]})})]})}function x(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(h,{...e})}):h(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>d});var c=i(96540);const l={},r=c.createContext(l);function s(e){const n=c.useContext(r);return c.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:s(e.components),c.createElement(r.Provider,{value:n},e.children)}}}]);